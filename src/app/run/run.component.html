<mat-sidenav-container fullscreen>
  <mat-sidenav mode="side" position="end" class="sidenav" [opened]="true" class="sidenav">

    <!-- TIMER -->
    <app-run-timer [run]="runHandler.run"></app-run-timer>

    <app-run-spectators [lobby]="runHandler.lobby"></app-run-spectators>
  </mat-sidenav>

  <mat-sidenav-content class="run">
    <!-- HEADER -->
    <div class="run-header">
      <div class="info">
        <p id="version" class="text-in-background" [title]="buildVersion">{{ buildVersion }}</p>
        
        <!-- Menu -->
        <svg class="settings" matTooltip="Open menu" matTooltipPosition="above" (click)="_user.viewSettings = !_user.viewSettings" version="1.0" viewBox="0 0 119.000000 99.000000" preserveAspectRatio="xMidYMid meet">
          <g transform="translate(0.000000,99.000000) scale(0.100000,-0.100000)" stroke="none">
            <path d="M190 905 l0 -85 445 0 445 0 0 85 0 85 -445 0 -445 0 0 -85z"/>
            <path d="M90 505 l0 -85 495 0 495 0 0 85 0 85 -495 0 -495 0 0 -85z"/>
            <path d="M290 105 l0 -85 395 0 395 0 0 85 0 85 -395 0 -395 0 0 -85z"/>
          </g>
        </svg>

        <!-- Twitch Link -->
        <svg class="settings" matTooltip="Copy MultiTwitch link" matTooltipClass="joni" matTooltipPosition="above" (click)="copyMultiTwitchLink()" version="1.0" viewBox="0 0 103.000000 119.000000" preserveAspectRatio="xMidYMid meet">
          <g transform="translate(0.000000,119.000000) scale(0.100000,-0.100000)" stroke="none">
            <path d="M67 1122 l-67 -68 0 -417 0 -417 150 0 150 0 0 -110 0 -110 28 0 c22 0 50 23 137 110 l110 110 100 0 100 0 118 118 117 117 0 368 0 367 -438 0 -438 0 -67 -68z m833 -304 l0 -263 -82 -82 -83 -83 -100 0 -99 0 -63 -62 -63 -62 0 62 0 62 -100 0 -100 0 0 312 0 312 32 33 32 33 313 0 313 0 0 -262z"/>
            <path d="M400 785 l0 -145 55 0 55 0 0 145 0 145 -55 0 -55 0 0 -145z"/>
            <path d="M700 785 l0 -145 55 0 55 0 0 145 0 145 -55 0 -55 0 0 -145z"/>
          </g>
        </svg>

        <!-- Back -->
        <svg class="settings" matTooltip="Back to lobby" matTooltipPosition="above" [routerLink]='["/lobby"]' version="1.0" viewBox="0 0 111.000000 104.000000" preserveAspectRatio="xMidYMid meet">
          <g transform="translate(0.000000,104.000000) scale(0.100000,-0.100000)" stroke="none">
            <path d="M285 788 c-148 -139 -270 -257 -270 -263 0 -11 527 -506 546 -513 5 -2 9 80 9 187 l0 191 265 0 265 0 0 135 0 135 -265 0 -265 0 0 190 c0 105 -3 190 -7 190 -5 -1 -129 -114 -278 -252z"/>
          </g>
        </svg>

      </div>
      <div class="title">
        <div>
          <p class="text-in-background" [title]="runHandler.run?.data?.name">{{ runHandler.run?.data?.name }}</p>
        </div>
      </div>
      <div class="logo-container">
        <div class="logo">
          <img src="./assets/teamrun-logo.png" alt="image">
        </div>
      </div>
    </div>

    <div class="run-body" *ngIf="runHandler.run">
      <!-- TEAMS -->
      <div class="run-info">
        <div class="run-info-teams">
          <div *ngFor="let team of runHandler.run.teams" class="team-cont">
            <p class="team-name">{{ team.name }}</p>
            <button *ngIf="runHandler.loaded && team.name !== localPlayer.team?.name && localPlayer.state !== playerState.Ready && runHandler.run.timer.runState === runState.Waiting"
              (click)="switchTeam(team.name)">Join</button>
            <div *ngFor="let player of team.players">
              <p [class.team-player-ready]="player.state === playerState.Ready && (runHandler.run.timer.runState === runState.Countdown || runHandler.run.timer.runState === runState.Waiting)" [class.team-player-reset]="player.state === playerState.WantsToReset">
                <img *ngIf="player.name == localPlayer.name && !_user.trackerConnected" class="run-info-teams-disconnected" [src]="'./assets/other/disconnected.png'">
                <img *ngIf="player.gameState?.onZoomer && _user.trackerConnected" class="run-info-teams-zoomer" [src]="'./assets/other/zoomer.png'">
                <img *ngIf="player.gameState?.currentLevel && _user.trackerConnected" class="run-info-teams-level" [src]="'./assets/levels/' + player.gameState.currentLevel + '.png'">
                <span>{{ player.name }}</span>
              </p>
            </div>
          </div>
        </div>
        <!-- READY -->
        <div class="run-info-details">
          <button [class.run-info-details-ready]="localPlayer.state == playerState.Ready && runHandler.run.timer.runState === runState.Waiting"
            [disabled]="runHandler.run.timer.runState === runState.Countdown || runHandler.run.timer.runState === runState.Ended || !_user.trackerConnected || !localPlayer.team"
            (click)="runHandler.run.timer.runState === runState.Started ? forfeit() : toggleReady()">{{ runHandler.run.timer.runState === runState.Started ? "Forfeit" : "Ready" }}</button>

            <button class="run-info-details-reset" 
            [disabled]="runHandler.run.timer.runState !== runState.Started"
            [class.run-info-details-reset-ready]="localPlayer.state === playerState.WantsToReset"
            (click)="toggleReset()">Vote Reset</button>

          <div class="run-info-details-owner">
            <p>Host:<span>{{ runHandler.lobby?.host }}</span></p>
          </div>
        </div>
      </div>


      <!-- RUN STATS -->
      <div class="prog">
        <app-run-splits *ngFor="let team of runHandler.run.teams; let i = index" [team]="team" class="prog-team" [class.prog-team-splitter]="i !== 0"></app-run-splits>
      </div>
    </div>
    <div *ngIf="!runHandler.run" id="error">
      <h1 class="text-in-background">Run not found!</h1>
    </div>

    <div class="backtext">
      <h1>theurn</h1>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>